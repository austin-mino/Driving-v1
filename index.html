<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>3D Car Game</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: #000;
    }
    #rotateWarning {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 20px;
      font-size: 20px;
      z-index: 99;
    }
    #ui {
      position: fixed;
      bottom: 20px;
      width: 100%;
      display: flex;
      justify-content: space-between;
      padding: 0 20px;
      z-index: 10;
    }
    #ui button {
      width: 80px;
      height: 50px;
      font-size: 16px;
      border: none;
      border-radius: 10px;
      background: #4f9eff;
      color: #fff;
      font-weight: bold;
    }
    #speed {
      position: fixed;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      color: #fff;
      background: rgba(0,0,0,0.5);
      padding: 6px 12px;
      border-radius: 8px;
      font-size: 18px;
      z-index: 10;
    }
  </style>
</head>
<body>
<div id="rotateWarning">가로 모드로 전환해주세요</div>
<div id="speed">속도: 0 km/h</div>
<div id="ui">
  <div>
    <button id="left">◀</button>
    <button id="right">▶</button>
  </div>
  <div>
    <button id="accel">에센</button>
    <button id="brake">브레이크</button>
  </div>
</div>
<canvas id="game"></canvas>
<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script>
const canvas = document.getElementById('game');
const renderer = new THREE.WebGLRenderer({ canvas });
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(0, 5, -10);
let carSpeed = 0, maxSpeed = 200, velocity = 0, direction = 0;

const car = new THREE.Mesh(
  new THREE.BoxGeometry(2, 1, 4),
  new THREE.MeshStandardMaterial({ color: 0x0077ff })
);
car.position.y = 0.5;
scene.add(car);

const light = new THREE.HemisphereLight(0xffffff, 0x444444);
scene.add(light);

const floor = new THREE.Mesh(
  new THREE.PlaneGeometry(1000, 1000),
  new THREE.MeshStandardMaterial({ color: 0x222222 })
);
floor.rotation.x = -Math.PI / 2;
floor.position.y = 0;
scene.add(floor);

function resize() {
  if (window.innerHeight > window.innerWidth) {
    document.getElementById('rotateWarning').style.display = 'block';
    return;
  } else {
    document.getElementById('rotateWarning').style.display = 'none';
  }
  renderer.setSize(window.innerWidth, window.innerHeight);
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
}
window.addEventListener('resize', resize);
resize();

let keys = { left: false, right: false, accel: false, brake: false };
document.getElementById('left').onpointerdown = () => keys.left = true;
document.getElementById('left').onpointerup = () => keys.left = false;
document.getElementById('right').onpointerdown = () => keys.right = true;
document.getElementById('right').onpointerup = () => keys.right = false;
document.getElementById('accel').onpointerdown = () => keys.accel = true;
document.getElementById('accel').onpointerup = () => keys.accel = false;
document.getElementById('brake').onpointerdown = () => keys.brake = true;
document.getElementById('brake').onpointerup = () => keys.brake = false;

function animate() {
  requestAnimationFrame(animate);

  if (keys.left) direction += 0.02;
  if (keys.right) direction -= 0.02;
  if (keys.accel) velocity += 0.5;
  if (keys.brake) velocity -= 1;
  
  velocity *= 0.98;
  velocity = Math.min(Math.max(velocity, 0), maxSpeed);

  car.rotation.y += direction * 0.5;
  car.position.x += Math.sin(car.rotation.y) * velocity * 0.01;
  car.position.z += Math.cos(car.rotation.y) * velocity * 0.01;

  camera.position.lerp(
    new THREE.Vector3(
      car.position.x - Math.sin(car.rotation.y) * 10,
      5,
      car.position.z - Math.cos(car.rotation.y) * 10
    ),
    0.1
  );
  camera.lookAt(car.position);

  document.getElementById('speed').textContent = `속도: ${Math.round(velocity)} km/h`;
  renderer.render(scene, camera);
}
animate();
</script>
</body>
</html>
