<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>3D Car Driving Game</title>

  <style>
    *{box-sizing:border-box}
    body{
      margin:0;overflow:hidden;
      background:#000;color:#fff;font-family:Arial,Helvetica,sans-serif
    }
    #rotateWarning{
      position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);
      background:rgba(0,0,0,.8);padding:20px;border-radius:10px;display:none;z-index:99
    }
    #buttons{
      position:fixed;bottom:20px;width:100%;display:flex;justify-content:space-between;
      padding:0 20px;z-index:10;pointer-events:none /* ë²„íŠ¼ ì˜ì—­ ê¹œë¹¡ì„ ë°©ì§€ */
    }
    #leftButtons,#rightButtons{display:flex;gap:10px}
    button{
      padding:14px 20px;font-size:16px;border:none;border-radius:12px;
      background:#4f9eff;color:#fff;font-weight:bold;pointer-events:auto
    }
    #speedometer,#driftIndicator{
      position:fixed;left:50%;transform:translateX(-50%);
      background:rgba(0,0,0,.6);padding:8px 20px;border-radius:10px;
      font-size:18px;font-weight:bold;text-align:center
    }
    #speedometer{bottom:80px}
    #driftIndicator{bottom:120px;opacity:0;transition:opacity .2s}
  </style>
</head>
<body>
  <div id="rotateWarning">ê°€ë¡œ ëª¨ë“œë¡œ ì „í™˜í•´ì£¼ì„¸ìš”</div>

  <div id="driftIndicator">ğŸ”¥ ë“œë¦¬í”„íŠ¸!</div>
  <div id="speedometer">ì†ë„: 0 km/h</div>

  <div id="buttons">
    <div id="leftButtons">
      <button id="leftBtn">â—€ ì¢Œ</button>
      <button id="rightBtn">ìš° â–¶</button>
    </div>
    <div id="rightButtons">
      <button id="accelBtn">ì—‘ì…€</button>
      <button id="brakeBtn">ë¸Œë ˆì´í¬</button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
  <script>
    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ê¸°ê¸° ë°©í–¥ ê²½ê³  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    const rotateWarning = document.getElementById("rotateWarning");
    function checkOrientation(){
      rotateWarning.style.display = (window.innerHeight>window.innerWidth)?"block":"none";
    }
    window.addEventListener("resize",checkOrientation);
    window.addEventListener("orientationchange",checkOrientation);
    checkOrientation();

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì „ì—­ ë³€ìˆ˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    let scene,camera,renderer,car;
    let velocity = 0, maxSpeed = 200;
    let steerAngle = 0, steerSpeed = 0.03, steerDecay = 0.006;
    let heading = 0;                 // ì‹¤ì œ ì§„í–‰ ë°©í–¥ (ë¯¸ë„ëŸ¬ì§ˆ ë•Œ ì°¨ì²´ ë°©í–¥ê³¼ ë‹¬ë¼ì§)
    let drifting = false;
    const driftThreshold = 0.18;     // í•¸ë“¤ êº¾ì„ í•œê³„
    const speedThreshold = 40;       // ë¯¸ë„ëŸ¬ì§€ê¸° ì‹œì‘í•  ìµœì†Œ ì†ë„
    const speedDisplay = document.getElementById("speedometer");
    const driftDisplay = document.getElementById("driftIndicator");

    init();
    animate();

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì´ˆê¸°í™” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function init(){
      scene = new THREE.Scene();
      scene.background = new THREE.Color(0x000000);

      camera = new THREE.PerspectiveCamera(60,window.innerWidth/window.innerHeight,0.1,1000);
      camera.position.set(0,5,-10);

      renderer = new THREE.WebGLRenderer({antialias:true});
      renderer.setSize(window.innerWidth,window.innerHeight);
      document.body.appendChild(renderer.domElement);

      // ë°”ë‹¥
      const floorGeo = new THREE.PlaneGeometry(1000,1000);
      const floorMat = new THREE.MeshStandardMaterial({color:0x222222});
      const floor = new THREE.Mesh(floorGeo,floorMat);
      floor.rotation.x = -Math.PI/2;
      scene.add(floor);

      // ì¡°ëª…
      scene.add(new THREE.DirectionalLight(0xffffff,1).position.set(10,20,10));
      scene.add(new THREE.AmbientLight(0xffffff,0.5));

      // ìë™ì°¨(ë°•ìŠ¤)
      const carGeo = new THREE.BoxGeometry(2,1,4);
      const carMat = new THREE.MeshStandardMaterial({color:0xff3333});
      car = new THREE.Mesh(carGeo,carMat);
      car.position.y = 0.5;
      scene.add(car);

      window.addEventListener("resize",()=>{
        camera.aspect = window.innerWidth/window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth,window.innerHeight);
      });

      setupControls();
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ë²„íŠ¼ ì…ë ¥ ì²˜ë¦¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function setupControls(){
      let left=false,right=false,accel=false,brake=false;

      function bind(id,setter){
        const btn=document.getElementById(id);
        btn.addEventListener("mousedown",()=>setter(true));
        btn.addEventListener("mouseup",()=>setter(false));
        btn.addEventListener("mouseleave",()=>setter(false));
        btn.addEventListener("touchstart",e=>{e.preventDefault();setter(true)});
        btn.addEventListener("touchend",()=>setter(false));
      }
      bind("leftBtn",v=>left=v);
      bind("rightBtn",v=>right=v);
      bind("accelBtn",v=>accel=v);
      bind("brakeBtn",v=>brake=v);

      /* ì…ë ¥ ìƒíƒœë¥¼ ì¼ì • ì£¼ê¸°ë¡œ ì—…ë°ì´íŠ¸ */
      setInterval(()=>{
        /* ì¡°í–¥ */
        if(left) steerAngle = Math.min(steerAngle + steerSpeed, 0.35);
        else if(right) steerAngle = Math.max(steerAngle - steerSpeed, -0.35);
        else{
          // ìì—° ë³µê·€
          if(steerAngle>0) steerAngle = Math.max(steerAngle - steerDecay, 0);
          else if(steerAngle<0) steerAngle = Math.min(steerAngle + steerDecay, 0);
        }

        /* ê°€ì†Â·ì œë™ */
        if(accel) velocity = Math.min(velocity + 1.2, maxSpeed);
        else if(brake) velocity = Math.max(velocity - 4, 0);
        else velocity = Math.max(velocity - 0.6, 0);

        /* ë“œë¦¬í”„íŠ¸ íŒì •: ì†ë„ + í•¸ë“¤ + (ë¸Œë ˆì´í¬ ì¤‘ì—” ì‰½ê²Œ) */
        drifting = (Math.abs(steerAngle) > driftThreshold && velocity > speedThreshold) || (brake && velocity>20 && Math.abs(steerAngle)>0.05);
        driftDisplay.style.opacity = drifting ? 1 : 0;
      },30);
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ë©”ì¸ ë£¨í”„ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function animate(){
      requestAnimationFrame(animate);

      /* ì°¨ì²´(ì‹œê°ì ì¸ ê²ƒ)ëŠ” ê³§ë°”ë¡œ ì¡°í–¥ ê°ë„ë¥¼ ë°˜ì˜ */
      car.rotation.y += steerAngle;

      /* ì§„í–‰ ë°©í–¥(heading)ì€ ê·¸ë¦½(Grip)ê°’ì— ë”°ë¼ ì°¨ì²´ ë°©í–¥ìœ¼ë¡œ ì„œì„œíˆ ìˆ˜ë ´
         ë“œë¦¬í”„íŠ¸ ì‹œ ê·¸ë¦½ì„ ì¤„ì—¬ ë¯¸ë„ëŸ¬ì§ íš¨ê³¼ */
      const grip = drifting ? 0.05 : 0.18;
      heading = lerpAngle(heading, car.rotation.y, grip);

      const moveZ = velocity * 0.02;
      car.position.x += Math.sin(heading) * moveZ;
      car.position.z += Math.cos(heading) * moveZ;

      /* ì¹´ë©”ë¼ */
      const cameraOffset = new THREE.Vector3(0,4,-10).applyMatrix4(car.matrixWorld);
      camera.position.lerp(cameraOffset,0.08);
      camera.lookAt(car.position);

      /* UI */
      speedDisplay.textContent = `ì†ë„: ${Math.floor(velocity)} km/h`;

      renderer.render(scene,camera);
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ë³´ì¡° í•¨ìˆ˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function lerpAngle(a,b,t){
      const diff = ((b - a + Math.PI) % (Math.PI*2)) - Math.PI;
      return a + diff*t;
    }
  </script>
</body>
</html>
